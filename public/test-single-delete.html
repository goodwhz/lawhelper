<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•æ¡åˆ é™¤åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .button.danger {
            background-color: #dc3545;
        }
        .button.danger:hover {
            background-color: #c82333;
        }
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "âœ“ ";
            color: green;
            font-weight: bold;
        }
        #results {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—‘ï¸ å•æ¡åˆ é™¤åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ åŠŸèƒ½è¯´æ˜</h3>
            <p>æ ¹æ®ä»£ç åˆ†æï¼Œé¡¹ç›®ä¸­å·²ç»å®ç°äº†å®Œæ•´çš„å•æ¡åˆ é™¤åŠŸèƒ½ï¼š</p>
            <ul class="feature-list">
                <li>UIç•Œé¢ï¼šæ¯ä¸ªå¯¹è¯é¡¹éƒ½æœ‰åˆ é™¤æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰</li>
                <li>åˆ é™¤ç¡®è®¤ï¼šç‚¹å‡»åˆ é™¤æŒ‰é’®ä¼šå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†</li>
                <li>APIæ¥å£ï¼š/api/conversations/[conversationId] DELETE æ–¹æ³•</li>
                <li>æ•°æ®åº“æ“ä½œï¼šé€šè¿‡Supabaseåˆ é™¤å¯¹è¯åŠç›¸å…³æ¶ˆæ¯</li>
                <li>ç”¨æˆ·è®¤è¯ï¼šæ”¯æŒBearer Tokenå’ŒX-User-IDä¸¤ç§è®¤è¯æ–¹å¼</li>
                <li>çŠ¶æ€ç®¡ç†ï¼šåˆ é™¤åè‡ªåŠ¨åˆ·æ–°å¯¹è¯åˆ—è¡¨</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ”— è®¿é—®æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€AIèŠå¤©é¡µé¢è¿›è¡Œå®é™…æµ‹è¯•ï¼š</p>
            <button class="button" onclick="openChatPage()">æ‰“å¼€AIèŠå¤©é¡µé¢</button>
            <div id="status" class="status info">
                å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ‰“å¼€AIèŠå¤©é¡µé¢</li>
                <li>ç™»å½•ç³»ç»Ÿï¼ˆå¦‚æœå°šæœªç™»å½•ï¼‰</li>
                <li>åœ¨å·¦ä¾§å¯¹è¯åˆ—è¡¨ä¸­æ‰¾åˆ°ä»»æ„å¯¹è¯</li>
                <li>å°†é¼ æ ‡æ‚¬åœåœ¨å¯¹è¯é¡¹ä¸Šï¼Œå³ä¾§ä¼šæ˜¾ç¤ºæ“ä½œæŒ‰é’®</li>
                <li>ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰</li>
                <li>åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»"ç¡®å®š"</li>
                <li>è§‚å¯Ÿå¯¹è¯æ˜¯å¦è¢«æˆåŠŸåˆ é™¤</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>âœ… é¢„æœŸç»“æœ</h3>
            <ul>
                <li>åˆ é™¤æŒ‰é’®åœ¨é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤º</li>
                <li>ç‚¹å‡»åˆ é™¤æŒ‰é’®ä¼šå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†</li>
                <li>ç¡®è®¤åå¯¹è¯è¢«ç«‹å³åˆ é™¤</li>
                <li>å¯¹è¯åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°ï¼Œå·²åˆ é™¤çš„å¯¹è¯æ¶ˆå¤±</li>
                <li>å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰å¯¹è¯ï¼Œä¼šè‡ªåŠ¨åŠ è½½å…¶ä»–å¯¹è¯æˆ–åˆ›å»ºæ–°å¯¹è¯</li>
                <li>åˆ é™¤æ“ä½œæœ‰é€‚å½“çš„é”™è¯¯å¤„ç†</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æŠ€æœ¯å®ç°</h3>
            <details>
                <summary>æŸ¥çœ‹è¯¦ç»†å®ç°</summary>
                <pre>
<code>å‰ç«¯ç»„ä»¶ï¼šapp/components/chat/IntegratedChat.tsx
- deleteConversation å‡½æ•°ï¼šå¤„ç†å•æ¡åˆ é™¤é€»è¾‘
- åˆ é™¤æŒ‰é’®UIï¼šæ‚¬åœæ˜¾ç¤ºçš„åƒåœ¾æ¡¶å›¾æ ‡
- ç¡®è®¤å¯¹è¯æ¡†ï¼šconfirm() åŸç”Ÿå¯¹è¯æ¡†

åç«¯APIï¼šapp/api/conversations/[conversationId]/route.ts
- DELETE æ–¹æ³•ï¼šå¤„ç†åˆ é™¤è¯·æ±‚
- ç”¨æˆ·è®¤è¯ï¼šBearer Token æˆ– X-User-ID
- æ•°æ®åº“æ“ä½œï¼šå…ˆåˆ é™¤æ¶ˆæ¯ï¼Œå†åˆ é™¤å¯¹è¯

æ•°æ®åº“ï¼šSupabase
- è¡¨ç»“æ„ï¼šconversations å’Œ messages è¡¨
- å¤–é”®å…³ç³»ï¼šmessages.conversation_id -> conversations.id
- çº§è”åˆ é™¤ï¼šåˆ é™¤å¯¹è¯æ—¶è‡ªåŠ¨åˆ é™¤ç›¸å…³æ¶ˆæ¯</code>
                </pre>
            </details>
        </div>

        <div id="results">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <p>è¯·åœ¨ä¸Šæ–¹æ­¥éª¤è¿›è¡Œæµ‹è¯•ï¼Œç„¶åè®°å½•ç»“æœï¼š</p>
        </div>
    </div>

    <script>
        function openChatPage() {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status info';
            statusEl.innerHTML = 'æ­£åœ¨æ‰“å¼€AIèŠå¤©é¡µé¢...';
            
            // æ‰“å¼€æ–°çª—å£è®¿é—®èŠå¤©é¡µé¢
            const chatWindow = window.open('/ai-chat', '_blank');
            
            if (chatWindow) {
                statusEl.className = 'status success';
                statusEl.innerHTML = 'âœ… AIèŠå¤©é¡µé¢å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€ï¼Œè¯·è¿›è¡Œæµ‹è¯•';
                
                // æ·»åŠ æµ‹è¯•è®°å½•åŠŸèƒ½
                setTimeout(() => {
                    addTestResult('é¡µé¢æ‰“å¼€æˆåŠŸ');
                }, 1000);
            } else {
                statusEl.className = 'status error';
                statusEl.innerHTML = 'âŒ æ— æ³•æ‰“å¼€æ–°çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®';
                addTestResult('é¡µé¢æ‰“å¼€å¤±è´¥', 'error');
            }
        }

        function addTestResult(message, type = 'success') {
            const resultsEl = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsEl.appendChild(resultDiv);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰æµ‹è¯•è®°å½•
            const testHistory = localStorage.getItem('deleteTestHistory');
            if (testHistory) {
                addTestResult('å‘ç°å†å²æµ‹è¯•è®°å½•', 'info');
            }
        });

        // ç›‘å¬æ¥è‡ªèŠå¤©é¡µé¢çš„æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'deleteTestResult') {
                addTestResult(event.data.message, event.data.status);
            }
        });
    </script>
</body>
</html>